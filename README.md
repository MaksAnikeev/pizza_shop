# Телеграм-бот пиццерии

Это бот, привязанный к магазину на платформе [elasticpat](hhttps://euwest.cm.elasticpath.com/account).
Бот предлагает меню продуктов, можно добавить/удалить продукты в корзину.
Бот запросит ваш адрес и расчитает расстояние до ближайшей пицеррии, предложит 
самовывоз или доставку. При выборе доставки или самовывоза расчитает стоимость 
заказа с доставкой и предложит оплатить. Бот привязан к платежному терминалу ЮКасса.
После оплаты курьеру отошлется сообщение с адресом доставки.

## Пример работы бота:

![max example](gifs/tg_bot.gif)


## Запуск:

### 1. Копируем содержимое проекта себе в рабочую директорию
```
git clone <метод копирования>
```
У вас будет 4 функциональных файла:
- pizza_bot.py - этот главный файл для работы с ТГ ботом
- moltin.py - это вспомогательный файл с функциями для обращения 
к базе данных магазина на платформе elasticpat
- create_db.py - это файл, в котором создавалась база данных с продуктами
на платформе elasticpat. Запуск функций в файле закомичен, если нужно конкретное действие
  (описано в функции), просто раскомить нужную функцию и запусти файл. Будет создана либо новая модель
либо объекты созданной модели.
- distance_payment.py - это вспомогательный файл где собраны функции расчета расстояния
установки таймера и совершение оплаты

### 2. Устанавливаем библиотеки:
```
pip install -r requirements.txt
```

### 3. Для хранения переменных окружения создаем файл .env:
```
touch .env
```
Для тестирования телеграм-бота добавляем токен в `.env` файл: `TG_BOT_TOKEN='токен вашего бота'`

После регистрации на [elasticpat](hhttps://euwest.cm.elasticpath.com/account) 
необходимо [авторизоваться](https://documentation.elasticpath.com/commerce-cloud/docs/api/basics/authentication/index.html)
и получить ключи, которые записываем в .env:
```pycon
CLIENT_SECRET='....'
CLIENT_ID='.....'
STORE_ID='....'
```
После создания вашего магазина на [elasticpat](hhttps://euwest.cm.elasticpath.com/account) 
необходимо создать прайс-лист и его ид записать в .env:
```pycon
PRICE_LIST_ID='71b86c9e-cc52-4934-9f3f-7......'
```

Для работы `redis`, в .env записываем:
```pycon
DATABASE_PASSWORD=''
DATABASE_HOST='localhost'
DATABASE_PORT=6379
```

Для работы с картами и вычисления расстояния нужно зарегистрироваться 
[Yandex geocoder API](https://dvmn.org/encyclopedia/api-docs/yandex-geocoder-api/)
и записать `API_YANDEX_KEY` в .env:
```pycon
API_YANDEX_KEY='1875d767-85e5-47b7-862c-899bcd.....'
```

Для работы с платежной системой нужно в Меню Payments у BotFather нажать /mybots, выбрать бота, и нажать Payments
выбрать ЮКассу и тестовый токен, который записываем в .env:
```pycon
PAYMENT_UKASSA_TOKEN='381764678:TEST:5....4'
```

### 4. Создаем магазин с товарами
на сайте `elasticpat`:
https://euwest.cm.elasticpath.com/products

или с помощью файла `create_db.py`

### 5. Запуск

Для запуска бота нужно запустить `redis` на компьютере в Ubuntu:
```pycon
$ sudo apt upgrade
$ sudo apt upgrade
$ sudo apt install redis-server
$ redis-server
```

## Цели проекта

Код написан в учебных целях — это урок в курсе по Python и веб-разработке на сайте [Devman](https://dvmn.org).
